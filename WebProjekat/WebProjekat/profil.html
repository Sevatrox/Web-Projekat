<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Profil</title>
    <script src="Scripts/jquery-3.3.1.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var korisnik = JSON.parse(sessionStorage.getItem("login"));
            console.log(korisnik);
            logovanje();
            UcitavanjeProfila(korisnik);

            function UcitavanjeProfila(korisnik){
                let uloga;
                if (korisnik.Uloga == 0)
                    uloga = "POSETILAC";
                else if (korisnik.Uloga == 1)
                    uloga = "TRENER";
                else
                    uloga = "VLASNIK";

                let pol;
                if (korisnik.Pol == "M")
                    pol = "Muski";
                else
                    pol = "Zenski";

                let profil = '<table id="table" style="height : auto; width : 600px;" class="table table-striped table-dark">';
                profil += '<tbody>';

                profil += '<tr><td><label>Naziv: </label></td><td><label>' + korisnik.KorisnickoIme + '</label></td></tr>';
                profil += '<tr><td><label>Lozinka: </label></td><td><input type="password" readonly value="' + korisnik.Lozinka + '"></td></tr>';
                profil += '<tr><td><label>Ime: </label></td><td><label>' + korisnik.Ime  + '</label></td></tr>';
                profil += '<tr><td><label>Prezime: </label></td><td><label>' + korisnik.Prezime  + '</label></td></tr>';
                profil += '<tr><td><label>Pol: </label></td><td><label>' + pol + '</label></td></tr>';
                profil += '<tr><td><label>Email </label></td><td><label>' + korisnik.Email + '</label></td></tr>';
                profil += '<tr><td><label>Datum rodjenja: </label></td><td><label>' + korisnik.DatumRodjenja + '</label></td></tr>';
                profil += '<tr><td><label>Uloga: </label></td><td><label>' + uloga + '</label></td></tr>';
                if (uloga == "TRENER") {
                    profil += '<tr><td><label>Angazovan u fitnes centru: </label></td><td><label>' + korisnik.AngazovanFitnesCentar.Naziv + '</label></td></tr>';
                }

                profil += '</tbody>';
                profil += '</table>';
                $("#tableContent").append(profil);
                console.log('profil loaded');
            }

            $.get("/api/grupniTrening", function (data, status) {
                GrupniTreninzi(data);
            });

            function GrupniTreninzi(data) {
                if (korisnik.Uloga == 0) {
                    let lista = '<tr><td><label>Grupni treninzi: </label></td><td>';
                    for (trening in korisnik.ListaTreningaPosetioca) {
                        for (element in data) {
                            if (korisnik.ListaTreningaPosetioca[trening] == data[element].Id) {
                                lista += '<label>' + data[element].Naziv + '</label><br>';
                            }
                        }
                    }
                    lista += '</td></tr>';
                    $('#tableContent tr:last').after(lista);
                }
                else if (korisnik.Uloga == 1) {
                    let lista = '<tr><td><label>Treninzi trenera: </label></td><td>';
                    for (trening in korisnik.ListaTreningaTrenera) {
                        for (element in data) {
                            if (korisnik.ListaTreningaTrenera[trening] == data[element].Id) {
                                lista += '<label>' + data[element].Naziv + '</label><br>';
                            }
                        }
                    }
                    lista += '</td></tr>';
                    $('#tableContent tr:last').after(lista);
                }
                else
                    return;
            }

            $.get("/api/fitnesCentar", function (data, status) {
                FitnesCentri(data);
            });

            function FitnesCentri(data) {
                if (korisnik.Uloga == 2) {
                    let lista = '<tr><td><label>Fitnes centri vlasnika: </label></td><td>';
                    for (centar in korisnik.VlasnikFitnesCentri) {
                        for (element in data) {
                            if (korisnik.VlasnikFitnesCentri[centar] == data[element].Id) {
                                lista += '<label>' + data[element].Naziv + '</label><br>';
                            }
                        }
                    }
                    lista += '</td></tr>';
                    $('#tableContent tr:last').after(lista);
                }
                else
                    return;
            }   
          
            $("#logOut").click(function () {
                sessionStorage.removeItem("login");
                logovanje();
                alert('Izlogovani ste');
            });

            function logovanje() {
                if (sessionStorage.getItem("login") == null) {
                    $("#profile").hide();
                    $("#update").hide();
                    $("#logOut").hide();
                }
                else {
                    $("#profile").show();
                    $("#update").show();
                    $("#logOut").show();
                }
            }
        });
    </script>
    <style>
        .firstDiv {
            position: relative;
            width: 600px;
            height: auto;
            margin: 0 auto;
        }

        .navbar {
            position: absolute;
            top: -8px;
            overflow: hidden;
            background-color: #373b3e;
            font-family: Arial;
            height: 45px;
            width: auto;
        }

            .navbar a {
                font-size: 16px;
                color: white;
                text-align: center;
                width: auto;
                height: 45px;
                padding: 9.5px;
                text-decoration: none;
            }

                .navbar a:hover {
                    color: #42F3FA;
                    border: 1px solid #42F3FA;
                    box-shadow: 0 0 5px rgba(0,255,0,.3), 0 0 10px rgba(0,255,0,.2), 0 0 15px rgba(0,255,0,.1), 0 2px 0 black
                }

        table[id=table] th, td {
            text-align: center;
        }

    </style>
</head>
<body>
    <div class="menuDiv navbar">
        <a id="home" href="index.html">Pocetna</a>
        <a id="profile" href="profil.html">Profil</a>
        <a id="update" href="update.html">Izmena podataka</a>
        <a id="logOut" href="index.html">Log out</a>
    </div>
    <h1 style="text-align: center;">Fitnes centri u Novom Sadu</h1>
    <div class="firstDiv" id="tableContent"></div>
</body>
</html>